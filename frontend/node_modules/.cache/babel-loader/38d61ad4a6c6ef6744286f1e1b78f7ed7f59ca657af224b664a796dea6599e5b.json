{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Users,AlertCircle,Search}from'lucide-react';import axios from'axios';import ConnectionStatus from'./ConnectionStatus';import PermissionDiagnostic from'./PermissionDiagnostic';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const FacebookLogin=_ref=>{let{onLogin,loading}=_ref;const[error,setError]=useState('');const[loginMethod,setLoginMethod]=useState('redirect');// Default to redirect\nconst[exchangingCode,setExchangingCode]=useState(false);const[manualToken,setManualToken]=useState('');const[showManualTokenInput,setShowManualTokenInput]=useState(false);const[showDiagnostic,setShowDiagnostic]=useState(false);const API_BASE=process.env.REACT_APP_BACKEND_URL||'';// Check for Facebook login redirect response\nuseEffect(()=>{const checkFacebookRedirectResponse=async()=>{// Check if we're returning from Facebook redirect\nconst urlParams=new URLSearchParams(window.location.search);const code=urlParams.get('code');const error=urlParams.get('error');const errorDescription=urlParams.get('error_description');if(error){setError(errorDescription||'Connexion Facebook annulée ou échouée');// Clean URL\nwindow.history.replaceState({},document.title,window.location.pathname);return;}if(code){// We have an authorization code, exchange it for access token via backend\nawait exchangeCodeForToken(code);return;}};checkFacebookRedirectResponse();},[]);const exchangeCodeForToken=async code=>{try{setExchangingCode(true);setError('');// Use the configured backend URL as base for redirect URI\nconst baseUrl=process.env.REACT_APP_BACKEND_URL||window.location.origin;const redirectUri=baseUrl+window.location.pathname;console.log('Exchange redirect URI:',redirectUri);const response=await axios.post(\"\".concat(API_BASE,\"/api/auth/facebook/exchange-code\"),{code:code,redirect_uri:redirectUri});if(response.data&&response.data.user){onLogin(response.data.access_token);// Clean URL\nwindow.history.replaceState({},document.title,window.location.pathname);}else{setError('Erreur lors de l\\'authentification');}}catch(err){var _err$response,_err$response$data;console.error('Error exchanging code for token:',err);const errorMsg=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||'Erreur lors de la connexion Facebook';setError(errorMsg);}finally{setExchangingCode(false);}};const detectPopupBlocker=()=>{try{const popup=window.open('','popup','width=1,height=1');if(!popup||popup.closed||typeof popup.closed==='undefined'){return true;// Popup blocked\n}popup.close();return false;// Popup not blocked\n}catch(e){return true;// Popup blocked\n}};const handleFacebookLoginPopup=()=>{if(loading||exchangingCode)return;setError('');// Check if FB SDK is available\nif(!window.FB){setError('Facebook SDK non disponible. Utilisez la méthode de redirection.');return;}// Check if popups are blocked\nif(detectPopupBlocker()){setError('Les popups sont bloquées. Utilisez la méthode de redirection.');return;}window.FB.login(response=>{if(response.authResponse){onLogin(response.authResponse.accessToken);}else if(response.status==='not_authorized'){setError('Vous devez autoriser l\\'application pour continuer');}else{setError('Connexion Facebook annulée ou échouée');}},{scope:'pages_manage_posts,pages_read_engagement,pages_show_list,business_management,read_insights'});};const handleFacebookLoginRedirect=()=>{if(loading||exchangingCode)return;setError('');// Use the configured backend URL as base for redirect URI\nconst baseUrl=process.env.REACT_APP_BACKEND_URL||window.location.origin;const redirectUri=baseUrl+window.location.pathname;console.log('Redirect URI:',redirectUri);const facebookAuthUrl=\"https://www.facebook.com/v18.0/dialog/oauth?\"+\"client_id=5664227323683118&\"+\"redirect_uri=\".concat(encodeURIComponent(redirectUri),\"&\")+\"scope=pages_manage_posts,pages_read_engagement,pages_show_list,business_management,read_insights&\"+\"response_type=code&\"+\"state=\".concat(Math.random().toString(36).substring(7));window.location.href=facebookAuthUrl;};const handleLogin=()=>{if(loginMethod==='popup'){handleFacebookLoginPopup();}else if(loginMethod==='manual'){handleManualTokenLogin();}else{handleFacebookLoginRedirect();}};const handleManualTokenLogin=async()=>{if(!manualToken.trim()){setError('Veuillez saisir un token d\\'accès Facebook valide');return;}try{setExchangingCode(true);setError('');console.log('Testing token:',manualToken.substring(0,20)+'...');// Test the token first with better error handling\nconst testResponse=await axios.post(\"\".concat(API_BASE,\"/api/debug/facebook-token\"),{token:manualToken});const testData=testResponse.data;console.log('Token validation response:',testData);if(testData.status!=='valid'){var _testData$error,_testData$error$error,_testData$error2;const errorMessage=((_testData$error=testData.error)===null||_testData$error===void 0?void 0:(_testData$error$error=_testData$error.error)===null||_testData$error$error===void 0?void 0:_testData$error$error.message)||((_testData$error2=testData.error)===null||_testData$error2===void 0?void 0:_testData$error2.message)||'Token expiré ou incorrect';setError(\"Token Facebook invalide: \".concat(errorMessage));return;}console.log('Token valid, proceeding with login...');// Login with the token\nonLogin(manualToken);}catch(err){console.error('Error with manual token:',err);if(err.message.includes('HTTP')){setError(\"Erreur de connexion: \".concat(err.message));}else if(err.name==='TypeError'&&err.message.includes('fetch')){setError('Impossible de se connecter au serveur. Vérifiez que le backend est accessible.');}else{setError(\"Erreur lors de la validation du token: \".concat(err.message));}}finally{setExchangingCode(false);}};const isLoading=loading||exchangingCode;return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(ConnectionStatus,{API_BASE:API_BASE}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-4 h-4 flex-shrink-0\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:error})]}),exchangingCode&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2 p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:\"Authentification en cours...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm text-gray-600\",children:\"M\\xE9thode de connexion :\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"redirect\",checked:loginMethod==='redirect',onChange:e=>setLoginMethod(e.target.value),className:\"text-facebook-primary\",disabled:isLoading}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:\"Redirection (n\\xE9cessite configuration domaine)\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"popup\",checked:loginMethod==='popup',onChange:e=>setLoginMethod(e.target.value),className:\"text-facebook-primary\",disabled:isLoading}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:\"Popup\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"manual\",checked:loginMethod==='manual',onChange:e=>setLoginMethod(e.target.value),className:\"text-facebook-primary\",disabled:isLoading}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:\"Token manuel (solution temporaire)\"})]})]})]}),loginMethod==='manual'&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm text-gray-600\",children:\"Token d'acc\\xE8s Facebook :\"}),/*#__PURE__*/_jsx(\"textarea\",{value:manualToken,onChange:e=>setManualToken(e.target.value),placeholder:\"Collez votre token Facebook ici...\",className:\"w-full p-2 border border-gray-300 rounded-lg text-sm\",rows:\"3\",disabled:isLoading}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-blue-600 space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCCB \",/*#__PURE__*/_jsx(\"strong\",{children:\"Comment obtenir un token :\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"1. Allez sur \",/*#__PURE__*/_jsx(\"a\",{href:\"https://developers.facebook.com/tools/explorer/\",target:\"_blank\",rel:\"noopener noreferrer\",className:\"underline\",children:\"Facebook Graph API Explorer\"})]}),/*#__PURE__*/_jsx(\"p\",{children:\"2. S\\xE9lectionnez App ID: 5664227323683118\"}),/*#__PURE__*/_jsx(\"p\",{children:\"3. G\\xE9n\\xE9rez un \\\"User Access Token\\\"\"}),/*#__PURE__*/_jsx(\"p\",{children:\"4. Ajoutez les permissions: pages_manage_posts, pages_read_engagement, pages_show_list, business_management\"}),/*#__PURE__*/_jsx(\"p\",{children:\"5. Copiez le token g\\xE9n\\xE9r\\xE9 et collez-le ci-dessus\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(\"a\",{href:\"https://developers.facebook.com/tools/explorer/?method=GET&path=me&version=v18.0\",target:\"_blank\",rel:\"noopener noreferrer\",className:\"inline-block bg-blue-600 text-white px-3 py-1 text-xs rounded hover:bg-blue-700 transition-colors\",children:\"\\uD83D\\uDE80 Ouvrir Graph API Explorer\"})})]})]}),manualToken&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowDiagnostic(true),className:\"w-full flex items-center justify-center space-x-2 p-2 border border-blue-300 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors\",children:[/*#__PURE__*/_jsx(Search,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Diagnostiquer les Permissions\"})]})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,disabled:isLoading||loginMethod==='manual'&&!manualToken.trim(),className:\"facebook-button w-full flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed\",children:isLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"span\",{children:exchangingCode?'Authentification...':'Connexion en cours...'})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Users,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:loginMethod==='manual'?'Tester le Token':'Se connecter avec Facebook'})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 text-center\",children:loginMethod==='redirect'?'⚠️ Nécessite configuration du domaine dans Facebook Developer Console':loginMethod==='popup'?'Une popup Facebook s\\'ouvrira pour la connexion':'Solution temporaire avec token manuel'}),showDiagnostic&&/*#__PURE__*/_jsx(PermissionDiagnostic,{token:manualToken,onClose:()=>setShowDiagnostic(false)})]});};export default FacebookLogin;","map":{"version":3,"names":["React","useEffect","useState","Users","AlertCircle","Search","axios","ConnectionStatus","PermissionDiagnostic","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","FacebookLogin","_ref","onLogin","loading","error","setError","loginMethod","setLoginMethod","exchangingCode","setExchangingCode","manualToken","setManualToken","showManualTokenInput","setShowManualTokenInput","showDiagnostic","setShowDiagnostic","API_BASE","process","env","REACT_APP_BACKEND_URL","checkFacebookRedirectResponse","urlParams","URLSearchParams","window","location","search","code","get","errorDescription","history","replaceState","document","title","pathname","exchangeCodeForToken","baseUrl","origin","redirectUri","console","log","response","post","concat","redirect_uri","data","user","access_token","err","_err$response","_err$response$data","errorMsg","detail","detectPopupBlocker","popup","open","closed","close","e","handleFacebookLoginPopup","FB","login","authResponse","accessToken","status","scope","handleFacebookLoginRedirect","facebookAuthUrl","encodeURIComponent","Math","random","toString","substring","href","handleLogin","handleManualTokenLogin","trim","testResponse","token","testData","_testData$error","_testData$error$error","_testData$error2","errorMessage","message","includes","name","isLoading","className","children","type","value","checked","onChange","target","disabled","placeholder","rows","rel","onClick","onClose"],"sources":["/app/frontend/src/components/FacebookLogin.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Users, AlertCircle, Search } from 'lucide-react';\nimport axios from 'axios';\nimport ConnectionStatus from './ConnectionStatus';\nimport PermissionDiagnostic from './PermissionDiagnostic';\n\nconst FacebookLogin = ({ onLogin, loading }) => {\n  const [error, setError] = useState('');\n  const [loginMethod, setLoginMethod] = useState('redirect'); // Default to redirect\n  const [exchangingCode, setExchangingCode] = useState(false);\n  const [manualToken, setManualToken] = useState('');\n  const [showManualTokenInput, setShowManualTokenInput] = useState(false);\n  const [showDiagnostic, setShowDiagnostic] = useState(false);\n\n  const API_BASE = process.env.REACT_APP_BACKEND_URL || '';\n\n  // Check for Facebook login redirect response\n  useEffect(() => {\n    const checkFacebookRedirectResponse = async () => {\n      // Check if we're returning from Facebook redirect\n      const urlParams = new URLSearchParams(window.location.search);\n      const code = urlParams.get('code');\n      const error = urlParams.get('error');\n      const errorDescription = urlParams.get('error_description');\n      \n      if (error) {\n        setError(errorDescription || 'Connexion Facebook annulée ou échouée');\n        // Clean URL\n        window.history.replaceState({}, document.title, window.location.pathname);\n        return;\n      }\n      \n      if (code) {\n        // We have an authorization code, exchange it for access token via backend\n        await exchangeCodeForToken(code);\n        return;\n      }\n    };\n    \n    checkFacebookRedirectResponse();\n  }, []);\n\n  const exchangeCodeForToken = async (code) => {\n    try {\n      setExchangingCode(true);\n      setError('');\n      \n      // Use the configured backend URL as base for redirect URI\n      const baseUrl = process.env.REACT_APP_BACKEND_URL || window.location.origin;\n      const redirectUri = baseUrl + window.location.pathname;\n      \n      console.log('Exchange redirect URI:', redirectUri);\n      \n      const response = await axios.post(`${API_BASE}/api/auth/facebook/exchange-code`, {\n        code: code,\n        redirect_uri: redirectUri\n      });\n      \n      if (response.data && response.data.user) {\n        onLogin(response.data.access_token);\n        // Clean URL\n        window.history.replaceState({}, document.title, window.location.pathname);\n      } else {\n        setError('Erreur lors de l\\'authentification');\n      }\n      \n    } catch (err) {\n      console.error('Error exchanging code for token:', err);\n      const errorMsg = err.response?.data?.detail || 'Erreur lors de la connexion Facebook';\n      setError(errorMsg);\n    } finally {\n      setExchangingCode(false);\n    }\n  };\n\n  const detectPopupBlocker = () => {\n    try {\n      const popup = window.open('', 'popup', 'width=1,height=1');\n      if (!popup || popup.closed || typeof popup.closed === 'undefined') {\n        return true; // Popup blocked\n      }\n      popup.close();\n      return false; // Popup not blocked\n    } catch (e) {\n      return true; // Popup blocked\n    }\n  };\n\n  const handleFacebookLoginPopup = () => {\n    if (loading || exchangingCode) return;\n    setError('');\n    \n    // Check if FB SDK is available\n    if (!window.FB) {\n      setError('Facebook SDK non disponible. Utilisez la méthode de redirection.');\n      return;\n    }\n    \n    // Check if popups are blocked\n    if (detectPopupBlocker()) {\n      setError('Les popups sont bloquées. Utilisez la méthode de redirection.');\n      return;\n    }\n    \n    window.FB.login((response) => {\n      if (response.authResponse) {\n        onLogin(response.authResponse.accessToken);\n      } else if (response.status === 'not_authorized') {\n        setError('Vous devez autoriser l\\'application pour continuer');\n      } else {\n        setError('Connexion Facebook annulée ou échouée');\n      }\n    }, {\n      scope: 'pages_manage_posts,pages_read_engagement,pages_show_list,business_management,read_insights'\n    });\n  };\n\n  const handleFacebookLoginRedirect = () => {\n    if (loading || exchangingCode) return;\n    setError('');\n    \n    // Use the configured backend URL as base for redirect URI\n    const baseUrl = process.env.REACT_APP_BACKEND_URL || window.location.origin;\n    const redirectUri = baseUrl + window.location.pathname;\n    \n    console.log('Redirect URI:', redirectUri);\n    \n    const facebookAuthUrl = `https://www.facebook.com/v18.0/dialog/oauth?` +\n      `client_id=5664227323683118&` +\n      `redirect_uri=${encodeURIComponent(redirectUri)}&` +\n      `scope=pages_manage_posts,pages_read_engagement,pages_show_list,business_management,read_insights&` +\n      `response_type=code&` +\n      `state=${Math.random().toString(36).substring(7)}`;\n    \n    window.location.href = facebookAuthUrl;\n  };\n\n  const handleLogin = () => {\n    if (loginMethod === 'popup') {\n      handleFacebookLoginPopup();\n    } else if (loginMethod === 'manual') {\n      handleManualTokenLogin();\n    } else {\n      handleFacebookLoginRedirect();\n    }\n  };\n\n  const handleManualTokenLogin = async () => {\n    if (!manualToken.trim()) {\n      setError('Veuillez saisir un token d\\'accès Facebook valide');\n      return;\n    }\n\n    try {\n      setExchangingCode(true);\n      setError('');\n      \n      console.log('Testing token:', manualToken.substring(0, 20) + '...');\n      \n      // Test the token first with better error handling\n      const testResponse = await axios.post(`${API_BASE}/api/debug/facebook-token`, {\n        token: manualToken\n      });\n      \n      const testData = testResponse.data;\n      console.log('Token validation response:', testData);\n      \n      if (testData.status !== 'valid') {\n        const errorMessage = testData.error?.error?.message || \n                            testData.error?.message || \n                            'Token expiré ou incorrect';\n        setError(`Token Facebook invalide: ${errorMessage}`);\n        return;\n      }\n\n      console.log('Token valid, proceeding with login...');\n      // Login with the token\n      onLogin(manualToken);\n      \n    } catch (err) {\n      console.error('Error with manual token:', err);\n      if (err.message.includes('HTTP')) {\n        setError(`Erreur de connexion: ${err.message}`);\n      } else if (err.name === 'TypeError' && err.message.includes('fetch')) {\n        setError('Impossible de se connecter au serveur. Vérifiez que le backend est accessible.');\n      } else {\n        setError(`Erreur lors de la validation du token: ${err.message}`);\n      }\n    } finally {\n      setExchangingCode(false);\n    }\n  };\n\n  const isLoading = loading || exchangingCode;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Connection Status Check */}\n      <ConnectionStatus API_BASE={API_BASE} />\n      \n      {error && (\n        <div className=\"flex items-center space-x-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700\">\n          <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\n          <span className=\"text-sm\">{error}</span>\n        </div>\n      )}\n      \n      {exchangingCode && (\n        <div className=\"flex items-center justify-center space-x-2 p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-700\">\n          <div className=\"spinner\" />\n          <span className=\"text-sm\">Authentification en cours...</span>\n        </div>\n      )}\n      \n      {/* Login Method Selection */}\n      <div className=\"space-y-2\">\n        <label className=\"text-sm text-gray-600\">Méthode de connexion :</label>\n        <div className=\"space-y-2\">\n          <label className=\"flex items-center space-x-2\">\n            <input\n              type=\"radio\"\n              value=\"redirect\"\n              checked={loginMethod === 'redirect'}\n              onChange={(e) => setLoginMethod(e.target.value)}\n              className=\"text-facebook-primary\"\n              disabled={isLoading}\n            />\n            <span className=\"text-sm\">Redirection (nécessite configuration domaine)</span>\n          </label>\n          <label className=\"flex items-center space-x-2\">\n            <input\n              type=\"radio\"\n              value=\"popup\"\n              checked={loginMethod === 'popup'}\n              onChange={(e) => setLoginMethod(e.target.value)}\n              className=\"text-facebook-primary\"\n              disabled={isLoading}\n            />\n            <span className=\"text-sm\">Popup</span>\n          </label>\n          <label className=\"flex items-center space-x-2\">\n            <input\n              type=\"radio\"\n              value=\"manual\"\n              checked={loginMethod === 'manual'}\n              onChange={(e) => setLoginMethod(e.target.value)}\n              className=\"text-facebook-primary\"\n              disabled={isLoading}\n            />\n            <span className=\"text-sm\">Token manuel (solution temporaire)</span>\n          </label>\n        </div>\n      </div>\n\n      {/* Manual Token Input */}\n      {loginMethod === 'manual' && (\n        <div className=\"space-y-2\">\n          <label className=\"text-sm text-gray-600\">\n            Token d'accès Facebook :\n          </label>\n          <textarea\n            value={manualToken}\n            onChange={(e) => setManualToken(e.target.value)}\n            placeholder=\"Collez votre token Facebook ici...\"\n            className=\"w-full p-2 border border-gray-300 rounded-lg text-sm\"\n            rows=\"3\"\n            disabled={isLoading}\n          />\n          <div className=\"text-xs text-blue-600 space-y-1\">\n            <p>📋 <strong>Comment obtenir un token :</strong></p>\n            <p>1. Allez sur <a href=\"https://developers.facebook.com/tools/explorer/\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline\">Facebook Graph API Explorer</a></p>\n            <p>2. Sélectionnez App ID: 5664227323683118</p>\n            <p>3. Générez un \"User Access Token\"</p>\n            <p>4. Ajoutez les permissions: pages_manage_posts, pages_read_engagement, pages_show_list, business_management</p>\n            <p>5. Copiez le token généré et collez-le ci-dessus</p>\n            <div className=\"mt-2\">\n              <a \n                href=\"https://developers.facebook.com/tools/explorer/?method=GET&path=me&version=v18.0\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                className=\"inline-block bg-blue-600 text-white px-3 py-1 text-xs rounded hover:bg-blue-700 transition-colors\"\n              >\n                🚀 Ouvrir Graph API Explorer\n              </a>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Diagnostic Button */}\n      {manualToken && (\n        <div className=\"mb-4\">\n          <button\n            onClick={() => setShowDiagnostic(true)}\n            className=\"w-full flex items-center justify-center space-x-2 p-2 border border-blue-300 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors\"\n          >\n            <Search className=\"w-4 h-4\" />\n            <span>Diagnostiquer les Permissions</span>\n          </button>\n        </div>\n      )}\n\n      <button\n        onClick={handleLogin}\n        disabled={isLoading || (loginMethod === 'manual' && !manualToken.trim())}\n        className=\"facebook-button w-full flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n      >\n        {isLoading ? (\n          <>\n            <div className=\"spinner\" />\n            <span>{exchangingCode ? 'Authentification...' : 'Connexion en cours...'}</span>\n          </>\n        ) : (\n          <>\n            <Users className=\"w-5 h-5\" />\n            <span>\n              {loginMethod === 'manual' ? 'Tester le Token' : 'Se connecter avec Facebook'}\n            </span>\n          </>\n        )}\n      </button>\n      \n      <div className=\"text-xs text-gray-500 text-center\">\n        {loginMethod === 'redirect' \n          ? '⚠️ Nécessite configuration du domaine dans Facebook Developer Console'\n          : loginMethod === 'popup'\n          ? 'Une popup Facebook s\\'ouvrira pour la connexion'\n          : 'Solution temporaire avec token manuel'\n        }\n      </div>\n      \n      {/* Diagnostic Modal */}\n      {showDiagnostic && (\n        <PermissionDiagnostic \n          token={manualToken}\n          onClose={() => setShowDiagnostic(false)}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default FacebookLogin;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}